var CurrentPageIndex=1,Global_JsonData,Global_HeaderFromJson=[],settings,table,HeaderNamesFromJson=[],dropdownListSelectedValues=[],TotalPages,colSpanForNoreCords;!function(){function e(){$.ajax({type:settings.type,url:settings.url,async:!1,contentType:settings.contentType,success:function(e){Global_JsonData=e.hasOwnProperty("d")?e.d:e},error:function(e,t,a){console.log(e.responseText),console.log(t.toString())}})}function t(){$.each(Global_JsonData,function(e,t){delete t.__type,Global_HeaderFromJson=$.map(t,function(e,t){return[t]})})}function a(e){var t="<div><div style='float:right;padding: 0.6%;'><label class='lblSearch'>Search </label>&nbsp<input id='searchtxt' type='text' class='srch'></div></div>";e.append(t)}function n(){table=$('<table id="tbl"></table>').addClass(settings.tableCss)}function r(){$("#tbl thead").remove();var e=Global_JsonData,t=$("<thead><tr></tr></thead>").addClass("HeaderCss");if(0===settings.Header.length){var a=[];$.each(e,function(e,t){delete t.__type,a=$.map(t,function(e,t){return[t]})}),$.each(a,function(n,r){var l=$("<th></th>"),i=Global_HeaderFromJson[n];if(l.addClass(i),1==settings.IsheaderDropdownList){var d=c(n,e),u=$("<div></div>");l.append(u.append(d))}if(settings.IsSortable){var p;$.each(Global_HeaderFromJson,function(e,t){n==e&&(p=t)});var v=$('<a id="'+r+'" sortOrderAsc="false" SortKey="'+p+'">'+r+"</a> <br>").click(function(){var t=$(this).attr("sortOrderAsc"),a=$(this).attr("SortKey");return e.sort(o(a,t)),$("#tbl tbody").remove(),s(e,CurrentPageIndex),"true"===t?$(this).attr("sortOrderAsc",!1):$(this).attr("sortOrderAsc",!0),!1});l.append(v)}else{var g=$("<div><label>"+r+"</div>");g.css("text-align","center"),l.append(g)}if(t.append(l),settings.Editable&&a.length-1==n){var b=$('<th><label class="HeaderLabel">Action<label></th>');b.addClass("ActioncellClass"),t.append(b)}})}else $.each(settings.Header,function(a,n){var r=$("<th></th>");if(1==settings.IsheaderDropdownList){var l=c(a,e),i=$("<div></div>");r.append(i.append(l))}if(settings.IsSortable){var d;$.each(Global_HeaderFromJson,function(e,t){a==e&&(d=t)});var u=$('<a id="'+n+'" sortOrderAsc="false" SortKey="'+d+'">'+n+"</a> <br>").click(function(){var t=$(this).attr("sortOrderAsc"),a=$(this).attr("SortKey");return e.sort(o(a,t)),$("#tbl tbody").remove(),s(e,CurrentPageIndex),"true"===t?$(this).attr("sortOrderAsc",!1):$(this).attr("sortOrderAsc",!0),!1});r.append(u)}else{var p=$('<div class="HeaderLabel">'+n+"</div>");p.css("text-align","center"),r.append(p)}if(t.append(r),settings.Editable&&settings.Header.length-1==a){var v=$('<th><label class="HeaderLabel">Action<label></th>');t.append(v)}});table.append(t)}function s(e,t){$("#tbl tbody").remove(),$("#tbl tfoot").remove();var a=_(e,t);table.attr("border",settings.border);var n=!1,r=$("<tbody></tbody>");if(0==e.length){var s;return s=settings.Editable?settings.Header.length+1:settings.Header.length,r.append($("<tr ><td  colspan='"+s+"' style='text-align: center;'><label>No Records Found</label></td></tr>")),void table.append(r)}$.each(a,function(e,t){if(!n){var a=$("<tr></tr>").addClass("rowCss");delete t.__type;var s=$.map(t,function(e,t){return[e]});$.each(s,function(t,n){var r=h(e,t,n),o=b(e,t,n);r.append(o);var l=Global_HeaderFromJson[t];r.addClass(l),a.append(r),m(s,e,t,a)}),r.append(a)}}),table.append(r),y(e)}function o(e,t){var a=1;"-"===e[0]&&(a=-1,e=e.substr(1));return"true"==t?function(t,n){var r=t[e]<n[e]?-1:t[e]>n[e]?1:0;return r*a}:function(t,n){var r=n[e]<t[e]?-1:n[e]>t[e]?1:0;return r*a}}function l(e,t){s(e,t)}function i(e,t){var a=[];return $.each(t,function(t,n){-1==$.inArray(n[e],a)&&a.push(n[e])}),a}function d(e,t){var a=e,n=[];if("0"!=a){var r=[];$.each(t,function(e,t){delete t.__type;var n=$.map(t,function(e,t){return[e]});$.each(n,function(t,n){var s=n.toString();return s.toLowerCase().indexOf(a.toLowerCase())>=0?void r.push(e):void 0})});var o=[];$.each(r,function(e,t){-1===$.inArray(t,o)&&o.push(t)}),$.each(o,function(e,a){n.push(t[a])}),0!=n.length&&($("#tbl tbody").remove(),s(n,1))}else $("#tbl tbody").remove(),s(Global_JsonData,CurrentPageIndex)}function c(e,t){var a=$("<select />").on("change",function(){d($(this).val(),t)});a.addClass("btn btn-primary dropdown-toggle");var n=Global_HeaderFromJson[e];$("<option />",{value:"0",text:"--Select--"}).appendTo(a);var r=i(n,t);return $.each(r,function(e,t){$("<option />",{value:t,text:t}).appendTo(a)}),a}function u(e,t,a){var n=$('<button id="Edit_'+e+"_"+t+'"">Edit</button>').click(function(){return $(this).css("display","none"),$("#Delete_"+e+"_"+t).css("display","none"),$("#Save_"+e+"_"+t).css("display",""),$("#Cancel_"+e+"_"+t).css("display",""),$("#Cancel_"+e+"_"+t).css("margin-left","2px"),$.each(Global_HeaderFromJson,function(t,a){a!=settings.primaryKey&&($("#txtbox_"+e+"_"+t).css("display",""),$("#par_"+e+"_"+t).css("display","none"))}),!1});return n}function p(e,t){var a=$('<button id="Save_'+e+"_"+t+'" style="display: none;">Save</button>').click(function(){var a={};$.each(Global_HeaderFromJson,function(t,n){if(n==settings.primaryKey)var r=$("#par_"+e+"_"+t).text();else var r=$("#txtbox_"+e+"_"+t).val();a[n]=r,$("#par_"+e+"_"+t).val(r)});var n=JSON.stringify(a),r=!1;if($.ajax({type:"POST",url:settings.surl,async:!1,dataType:"json",contentType:"application/json; charset=utf-8",data:"{"+settings.sdata+":"+n+"} ",success:function(e){console.log("saved Successfully"),r=!0},error:function(e,t,a){console.log("something went wrong, please try again")}}),r)for(var s=0;s<array.length;s++)$("#txtbox_"+e+"_"+s).css("display","none"),$("#par_"+e+"_"+s).css("display","");return $(this).css("display","none"),$("#Cancel_"+e+"_"+t).css("display","none"),$("#Edit_"+e+"_"+t).css("display",""),$("#Delete_"+e+"_"+s).css("display",""),!1});return a}function v(e,t,a){var n=$('<button id="Cancel_'+e+"_"+t+'" style="display: none;">Cancel</button>').click(function(){$(this).css("display","none"),$("#Save_"+e+"_"+t).css("display","none"),$("#Edit_"+e+"_"+t).css("display",""),$("#Delete_"+e+"_"+t).css("display","");for(var n=0;a>n;n++)$("#txtbox_"+e+"_"+n).css("display","none"),$("#par_"+e+"_"+n).css("display","");return!1});return n}function g(t,a,n){var o=$('<button id="Delete_'+t+"_"+a+'" style="margin-left:2px;">Delete</button>').click(function(){var a={};$.each(Global_HeaderFromJson,function(e,n){var r=$("#par_"+t+"_"+e).text();a[n]=r});var n=JSON.stringify(a),o=!1;return $.ajax({type:"POST",url:settings.durl,async:!1,dataType:"json",contentType:"application/json; charset=utf-8",data:"{"+settings.ddata+":"+n+"} ",success:function(e){console.log("Deleted Successfully"),o=!0},error:function(e,t,a){console.log("something went wrong, please try again")}}),o&&(e(),TotalPages=Math.round(Global_JsonData.length/10),r(),s(Global_JsonData,CurrentPageIndex)),!1});return o}function b(e,t,a){var n=$('<input id="txtbox_'+e+"_"+t+'" value="'+a+'"style="display: none;width: 100%; ">');return Global_HeaderFromJson[t]==settings.primaryKey&&(n=""),n}function f(){var e=$('<div id="currentPage"><label> Current Page</label> </div>'),t=$('<input type="number" id="GoToPage" value='+CurrentPageIndex+' min="1" max="'+TotalPages+'" />').on("input",function(){CurrentPageIndex=$(this).val(),isNaN(CurrentPageIndex)||l(Global_JsonData,CurrentPageIndex)});e.css("margin-left","40%"),e.css("width","50%");var a=$('<span style="float:right;padding: 4.1px;"> <label> Total Pages :</label>'+TotalPages+"</span>");return t.addClass("GoToPage"),e.append(t),e.append(a),e}function h(e,t,a){var n;n=$.isNumeric(a)||null==a||""==a?null!=a?a:"":a.length>=10?a:a;var r=$('<td  cellIndex ="'+e+"_"+t+'"><p id="par_'+e+"_"+t+'" title="'+a+'">'+n+"</p></td>").append();return r}function y(e){var t;t=settings.Editable?Global_HeaderFromJson.length+1:Global_HeaderFromJson.length,colSpanForNoreCords=t;var a=$("<tfoot></tfoot>"),n=$("<tr></tr>"),r=$('<td colspan="'+t+'"></td>'),s=e.length,o=Math.round(s/10);if(1==o&&(o=0),0!=o){var l=$("<div></div>"),i=x(e,1);l.append(i);var d=C(e,1);l.append(d);var c=f();l.append(c),r.append(l),n.append(r),n.append(r)}a.append(n),table.append(a)}function _(e,t){var a=10*t,n=Math.abs(a-10),r=e.slice(n,a);return r}function x(e,t){var a=$('<a id="Next">Next</a>').click(function(){return CurrentPageIndex==TotalPages?$(this).css("display","none"):(CurrentPageIndex=Number(CurrentPageIndex)+Number(1),l(e,CurrentPageIndex),$("#Previous").css("display","")),!1});return CurrentPageIndex==TotalPages&&a.css("display","none"),a.addClass("NextPrevious"),a}function C(e,t){var a=$('<a id="Previous">Previous</a>').click(function(){return CurrentPageIndex=$("#GoToPage").val(),1==CurrentPageIndex?$(this).css("display","none"):(CurrentPageIndex=Number(CurrentPageIndex)-Number(1),l(e,CurrentPageIndex),$("#Next").css("display","")),!1});return 1==CurrentPageIndex&&a.css("display","none"),a.addClass("NextPrevious"),a}function m(e,t,a,n){if(settings.Editable&&e.length-1==a){var r=u(t,a,e.length),s=g(t,a,e.length),o=p(t,a),l=v(t,a,e.length),i=$("<td></td>").append(r);i.append(o),i.append(l),i.append(s),i.addClass("ActioncellClass"),n.append(i)}}$.fn.JqTable=function(o){settings=$.extend({Header:[],border:"1px",url:"",sdata:"",surl:"",durl:"",ddata:"",contentType:"application/json; charset=utf-8",search:"",tableCss:"",Editable:!1,Pageable:!1,IsheaderDropdownList:!1,primaryKey:"",IsSortable:!1},o),e(),TotalPages=Math.round(Global_JsonData.length/10),t(),a(this),n(),r(),s(Global_JsonData,CurrentPageIndex),$("#searchtxt").on("input",function(){var e=$("#searchtxt").val(),t=[];if(""!=e){var a=[];$.each(Global_JsonData,function(t,n){delete n.__type;var r=$.map(n,function(e,t){return[e]});$.each(r,function(n,r){var s=r.toString();return s.toLowerCase().indexOf(e.toLowerCase())>=0?void a.push(t):void 0})});var n=[];$.each(a,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),$.each(n,function(e,a){t.push(Global_JsonData[a])}),0!=t.length&&($("#tbl tbody").remove(),s(t,1))}else $("#tbl tbody").remove(),s(Global_JsonData,CurrentPageIndex)});var l=$("<div></div>");return l.addClass("DivEnclosed"),l.append(table),this.append(l),this.addClass("PluginCss"),this}}(jQuery());